
# 8.15笔记

## 1.CAN通讯

- 优点：可靠性高，传输距离远，抗干扰能力强
- CAN 控制器根据两根线上的电位差来判断总线电平。分为显性电平和隐性电平。显性为0，表示两线有电位差；隐形为1，表示两线电位差为0。
- 只要有一个单元为显性电平，总线就是显性电平
- 网络两端要有120Ω电阻

## 2.STM32-CAN 

- 仲裁方法：  
  1.最先开始发送的获得发送权  
  2.同时发送多个，连续输出显性电平最多的的获得发送权 

- 掩码中的1表示在这个位置上必须匹配，0表示可以不考虑这个位置

- _FilterConfig.FilterBank = 1;     
  _FilterConfig.FilterMode =     CAN_FILTERMODE_IDLIST;       （LIST——列表模式，MASK——掩码模式）
  _FilterConfig.FilterScale = CAN_FILTERSCALE_16BIT;     （16位 / 32位）

- _FilterConfig.FilterIdHigh = (0x00402010 << 3) >> 16;  
  _FilterConfig.FilterMaskIdHigh = (0x0FFFF0FF << 3) & 0xffff;
  _FilterConfig.FilterIdLow = (0x00203010 << 3) >> 16;
  _FilterConfig.FilterMaskIdLow = (0x0FFFF0FF << 3) & 0xffff;   （32位掩码模式）

-  _FilterConfig.FilterIdHigh = ((0x01020401 << 3)| CAN_ID_EXT | CAN_RTR_DATA ) >> 16;
  _FilterConfig.FilterMaskIdHigh = ((0x01020401 << 3) | CAN_ID_EXT | CAN_RTR_DATA ) & 0xffff;
  _FilterConfig.FilterIdLow = ((0x01020403 << 3) | CAN_ID_EXT | CAN_RTR_DATA ) >> 16;
  _FilterConfig.FilterMaskIdLow = ((0x01020403 << 3) | CAN_ID_EXT | CAN_RTR_DATA ) & 0xffff;   （32位列表模式）

## 3.创建工程

- 三种模式：回环模式、静默模式、静默回环模式

- 回环模式：自发自收，但只能接收自己发出的数据

- 过滤器

- 定义报文的头部结构体

## 4.CANABLE

- 将Bitrate调至1000000

- delta 时间间隔的模式

- 可以通过canable发送报文